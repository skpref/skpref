<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="We will demonstrate skpref on discrete choice data" href="swissmetro_discrete_choice.html" /><link rel="prev" title="Jupyter Notebook Examples" href="jupyter_notebook_examples.html" />

    <meta name="generator" content="sphinx-4.3.2, furo 2022.01.02"/>
        <title>Bradley Terry example notebook - skpref 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">skpref 0.0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">skpref 0.0.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README_symbolic.html">Welcome to skpref</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_symbolic.html#models-in-the-package">Models in the package</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_symbolic.html#novelties-in-skpref-to-the-scikit-learn-user">Novelties in skpref to the scikit-learn user</a></li>
<li class="toctree-l1"><a class="reference internal" href="README_symbolic.html#types-of-relations-that-can-be-modelled-in-skpref-11-01-2022">Types of relations that can be modelled in skpref (11/01/2022)</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_documentation.html">Module documentation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="jupyter_notebook_examples.html">Jupyter Notebook Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Bradley Terry example notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Reading-in-the-data">Reading in the data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Setting-up-the-tasks">Setting up the tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Fitting-a-Logistic-Regression">Fitting a Logistic Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Reduction-to-logistic-regression-with-covariates">Reduction to logistic regression with covariates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Bradley-Terry-model-with-salary-covariate">Bradley Terry model with salary covariate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Example-using-GridSearchCV()">Example using GridSearchCV()</a></li>
<li class="toctree-l2"><a class="reference internal" href="swissmetro_discrete_choice.html">We will demonstrate skpref on discrete choice data</a></li>
<li class="toctree-l2"><a class="reference internal" href="swissmetro_discrete_choice.html#Changing-the-format-of-the-tables-for-skpref">Changing the format of the tables for skpref</a></li>
<li class="toctree-l2"><a class="reference internal" href="swissmetro_discrete_choice.html#Using-only-a-subset-of-the-available-features">Using only a subset of the available features</a></li>
<li class="toctree-l2"><a class="reference internal" href="swissmetro_discrete_choice.html#Fit-a-logistic-regression">Fit a logistic regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="swissmetro_discrete_choice.html#Fit-a-Bradley-Terry-model-without-covariates">Fit a Bradley-Terry model without covariates</a></li>
<li class="toctree-l2"><a class="reference internal" href="swissmetro_discrete_choice.html#Fitting-a-Bradley-Terry-model-with-covariates">Fitting a Bradley-Terry model with covariates</a></li>
<li class="toctree-l2"><a class="reference internal" href="swissmetro_discrete_choice.html#Evaluation-methods">Evaluation methods</a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Bradley-Terry-example-notebook">
<h1>Bradley Terry example notebook<a class="headerlink" href="#Bradley-Terry-example-notebook" title="Permalink to this headline">¶</a></h1>
<p>What you will find in this notebook examples of using skpref:</p>
<ul class="simple">
<li><p>for setting up the modelling task based framework</p></li>
<li><p>to fit a classifier that’s being read in from scikit-learn on the same problem which in the background uses reduction and aggregation methods.</p></li>
<li><p>to fit a Bradley-Terry model with and without covariates on the pairwise comparison data of basketball matches.</p></li>
<li><p>for applying the GridSearch technique for model selection</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optionally change the theme of the notebook to dark</span>
<span class="c1"># from jupyterthemes.stylefx import set_nb_theme</span>
<span class="c1"># set_nb_theme('chesterish')</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import skpref modules</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"../.."</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">skpref.random_utility</span> <span class="kn">import</span> <span class="n">BradleyTerry</span>
<span class="kn">from</span> <span class="nn">skpref.task</span> <span class="kn">import</span> <span class="n">PairwiseComparisonTask</span>
<span class="kn">from</span> <span class="nn">skpref.base</span> <span class="kn">import</span> <span class="n">ClassificationReducer</span>
<span class="kn">from</span> <span class="nn">skpref.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">skpref.utils</span> <span class="kn">import</span> <span class="n">nice_print_results</span>

<span class="c1"># Import scikit-learn packages to be used in tandem with skpref architecture</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span>

<span class="c1"># Import other useful packages</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Reading-in-the-data">
<h1>Reading in the data<a class="headerlink" href="#Reading-in-the-data" title="Permalink to this headline">¶</a></h1>
<p>The example dataset will be matches played by NBA teams, we will use the 2016 season’s matches to predict the results of the 2017 matches. The dataset contains:</p>
<ul class="simple">
<li><p>a column for <code class="docutils literal notranslate"><span class="pre">team1</span></code> and <code class="docutils literal notranslate"><span class="pre">team2</span></code> indicating the two teams that have played each other</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">season_start</span></code>, which indicates which season the match belongs to</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">team1_wins</span></code> takes the value of 1 if the team in column <code class="docutils literal notranslate"><span class="pre">team1</span></code> win the match, 0 if they lost (there are no ties in basketball)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">team_1_home</span></code> takes the value of 1 if <code class="docutils literal notranslate"><span class="pre">team1</span></code> was playing in their home court 0 if they were paying away (no neutral courts in the NBA)</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NBA_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'data/NBA_matches.csv'</span><span class="p">)</span>
<span class="n">NBA_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-wrapper"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>team1</th>
<th>team2</th>
<th>season_start</th>
<th>team1_wins</th>
<th>team_1_home</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Atlanta Hawks</td>
<td>Toronto Raptors</td>
<td>2014</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>1</th>
<td>Atlanta Hawks</td>
<td>Indiana Pacers</td>
<td>2014</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>2</th>
<td>Atlanta Hawks</td>
<td>San Antonio Spurs</td>
<td>2014</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>3</th>
<td>Atlanta Hawks</td>
<td>Charlotte Hornets</td>
<td>2014</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>4</th>
<td>Atlanta Hawks</td>
<td>New York Knicks</td>
<td>2014</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table></div>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NBA_results</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-wrapper"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>team1</th>
<th>team2</th>
<th>season_start</th>
<th>team1_wins</th>
<th>team_1_home</th>
</tr>
</thead>
<tbody>
<tr>
<th>9835</th>
<td>Washington Wizards</td>
<td>Houston Rockets</td>
<td>2017</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>9836</th>
<td>Washington Wizards</td>
<td>Cleveland Cavaliers</td>
<td>2017</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>9837</th>
<td>Washington Wizards</td>
<td>Atlanta Hawks</td>
<td>2017</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>9838</th>
<td>Washington Wizards</td>
<td>Boston Celtics</td>
<td>2017</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>9839</th>
<td>Washington Wizards</td>
<td>Orlando Magic</td>
<td>2017</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table></div>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">season_split</span> <span class="o">=</span> <span class="mi">2016</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">NBA_results</span><span class="p">[</span><span class="n">NBA_results</span><span class="o">.</span><span class="n">season_start</span> <span class="o">==</span> <span class="n">season_split</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">NBA_results</span><span class="p">[</span><span class="n">NBA_results</span><span class="o">.</span><span class="n">season_start</span> <span class="o">==</span> <span class="n">season_split</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We will also use team salary data as covariates in the model later, with the idea being that a team that has more money to pay to their athletes has an advantage over other teams, by having a better chance to attract the top talent in the league.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NBA_team_salary_budget</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'data/team_salary_budgets.csv'</span><span class="p">)</span>
<span class="n">NBA_team_salary_budget</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-wrapper"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>team</th>
<th>season_start</th>
<th>salary</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Atlanta Hawks</td>
<td>2014</td>
<td>58337671</td>
</tr>
<tr>
<th>1</th>
<td>Atlanta Hawks</td>
<td>2015</td>
<td>71378126</td>
</tr>
<tr>
<th>2</th>
<td>Atlanta Hawks</td>
<td>2016</td>
<td>95957250</td>
</tr>
<tr>
<th>3</th>
<td>Atlanta Hawks</td>
<td>2017</td>
<td>99375302</td>
</tr>
<tr>
<th>4</th>
<td>Boston Celtics</td>
<td>2014</td>
<td>59418142</td>
</tr>
</tbody>
</table></div>
</div></div>
</div>
</div>
<div class="section" id="Setting-up-the-tasks">
<h1>Setting up the tasks<a class="headerlink" href="#Setting-up-the-tasks" title="Permalink to this headline">¶</a></h1>
<p>We set up the preference learning task by using the <code class="docutils literal notranslate"><span class="pre">PairwiseComparisonTask</span></code> object in <code class="docutils literal notranslate"><span class="pre">skpref</span></code>. This is the only extra step which might be a completely new concept to seasoned scikit-learn users. Once the task is specified, say in this case a pairwise comparison task, for any models applied in skpref, whether that is a reduction via scikit-learn or even a model that is not a pairwise comparison model, the package will know that the problem itself is a pairwise comparison problem and can
perform reduction and aggregation adequately in the background when needed.</p>
<p>In this example the <code class="docutils literal notranslate"><span class="pre">PairwiseComparisonTask</span></code> has the following components:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">primary_table</span></code>: the table that contains the observed preferences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">primary_table_alternatives_names</span></code>: the column or columns that contain the alternatives, in this case both columns team1 and team2 contain alternatives</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">primary_table_target_name</span></code>: the column that indicates the result of the pairwise comparison</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_column_correspondence</span></code>: in the case of pairwise comparisons, when the alternatives are split across two columns, the column indicating the result usually takes the form 1/0 to show whether one of the columns, in our case team1 or team2 has been preferred. So in this column the user indicates that when the team1_wins column takes the value 1 that means that the alternative in the column team1 has won.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">features_to_use</span></code>: indicates which columns to use as covariates</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NBA_results_task_train_LR</span> <span class="o">=</span> <span class="n">PairwiseComparisonTask</span><span class="p">(</span>
    <span class="n">primary_table</span><span class="o">=</span><span class="n">train_data</span><span class="p">,</span>
    <span class="n">primary_table_alternatives_names</span><span class="o">=</span><span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">],</span>
    <span class="n">primary_table_target_name</span> <span class="o">=</span><span class="s1">'team1_wins'</span><span class="p">,</span>
    <span class="n">target_column_correspondence</span><span class="o">=</span><span class="s1">'team1'</span><span class="p">,</span>
    <span class="n">features_to_use</span><span class="o">=</span><span class="p">[</span><span class="s1">'team_1_home'</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># For the test task, it's possible to make a copy of the training task and</span>
<span class="c1"># update the primary table</span>
<span class="n">NBA_results_task_predict_LR</span> <span class="o">=</span> <span class="n">PairwiseComparisonTask</span><span class="p">(</span>
    <span class="n">primary_table</span><span class="o">=</span><span class="n">test_data</span><span class="p">,</span>
    <span class="n">primary_table_alternatives_names</span><span class="o">=</span><span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">],</span>
    <span class="n">primary_table_target_name</span> <span class="o">=</span><span class="s1">'team1_wins'</span><span class="p">,</span>
    <span class="n">target_column_correspondence</span><span class="o">=</span><span class="s1">'team1'</span><span class="p">,</span>
    <span class="n">features_to_use</span><span class="o">=</span><span class="p">[</span><span class="s1">'team_1_home'</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Fitting-a-Logistic-Regression">
<h1>Fitting a Logistic Regression<a class="headerlink" href="#Fitting-a-Logistic-Regression" title="Permalink to this headline">¶</a></h1>
<p>The only covariate we will use in this for now will be the <code class="docutils literal notranslate"><span class="pre">team_1_home</span></code> column, which should return a method that only learns what the home team advantage was on average, which is the equivalent to fitting a logistic regression where whether team1 is playing home or not is the only covariate.</p>
<p><span class="math notranslate nohighlight">\(P(\texttt{team1}\_\texttt{wins}=1) = logit(\alpha + \beta_1 \texttt{team}\_\texttt{1}\_\texttt{home})\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_log_red</span> <span class="o">=</span> <span class="n">ClassificationReducer</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">'lbfgs'</span><span class="p">))</span>
<span class="n">my_log_red</span><span class="o">.</span><span class="n">fit_task</span><span class="p">(</span><span class="n">NBA_results_task_train_LR</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">my_log_red</span><span class="o">.</span><span class="n">predict_task</span><span class="p">(</span><span class="n">NBA_results_task_predict_LR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># predict_task returns a SubsetPosetVector which has the attributes</span>
<span class="c1"># top_input_data and boot_input_data corresponding to chosen and not chosen</span>
<span class="c1"># alternatives.</span>
<span class="n">preds</span><span class="o">.</span><span class="n">top_input_data</span><span class="p">,</span> <span class="n">preds</span><span class="o">.</span><span class="n">boot_input_data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array(['Dallas Mavericks', 'Charlotte Hornets', 'Brooklyn Nets', ...,
        'Washington Wizards', 'Washington Wizards', 'Orlando Magic'],
       dtype=object),
 array(['Atlanta Hawks', 'Atlanta Hawks', 'Atlanta Hawks', ...,
        'Atlanta Hawks', 'Boston Celtics', 'Washington Wizards'],
       dtype=object))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NBA_results_task_predict_LR</span><span class="o">.</span><span class="n">primary_table</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-wrapper"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>team1</th>
<th>team2</th>
<th>season_start</th>
<th>team1_wins</th>
<th>team_1_home</th>
</tr>
</thead>
<tbody>
<tr>
<th>7380</th>
<td>Atlanta Hawks</td>
<td>Dallas Mavericks</td>
<td>2017</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<th>7381</th>
<td>Atlanta Hawks</td>
<td>Charlotte Hornets</td>
<td>2017</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>7382</th>
<td>Atlanta Hawks</td>
<td>Brooklyn Nets</td>
<td>2017</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>7383</th>
<td>Atlanta Hawks</td>
<td>Miami Heat</td>
<td>2017</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>7384</th>
<td>Atlanta Hawks</td>
<td>Chicago Bulls</td>
<td>2017</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table></div>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NBA_results_task_predict_LR</span><span class="o">.</span><span class="n">primary_table</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-wrapper"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>team1</th>
<th>team2</th>
<th>season_start</th>
<th>team1_wins</th>
<th>team_1_home</th>
</tr>
</thead>
<tbody>
<tr>
<th>9835</th>
<td>Washington Wizards</td>
<td>Houston Rockets</td>
<td>2017</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>9836</th>
<td>Washington Wizards</td>
<td>Cleveland Cavaliers</td>
<td>2017</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<th>9837</th>
<td>Washington Wizards</td>
<td>Atlanta Hawks</td>
<td>2017</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<th>9838</th>
<td>Washington Wizards</td>
<td>Boston Celtics</td>
<td>2017</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<th>9839</th>
<td>Washington Wizards</td>
<td>Orlando Magic</td>
<td>2017</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table></div>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># All this learns so far is the home team advantage, since its the only</span>
<span class="c1"># covariate in the test_data table</span>
<span class="n">nice_print_results</span><span class="p">(</span>
    <span class="n">my_log_red</span><span class="o">.</span><span class="n">predict_proba_task</span><span class="p">(</span><span class="n">NBA_results_task_predict_LR</span><span class="p">,</span>
                                  <span class="n">outcome</span><span class="o">=</span><span class="p">[</span><span class="s1">'Dallas Mavericks'</span><span class="p">,</span> <span class="s1">'Atlanta Hawks'</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dallas Mavericks  [0.58 0.   0.   ... 0.   0.   0.  ]
Atlanta Hawks     [0.42 0.42 0.42 ... 0.42 0.   0.  ]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nice_print_results</span><span class="p">(</span>
    <span class="n">my_log_red</span><span class="o">.</span><span class="n">predict_proba_task</span><span class="p">(</span><span class="n">NBA_results_task_predict_LR</span><span class="p">,</span>
                                  <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
team1 is preferred  [0.42 0.42 0.42 ... 0.58 0.58 0.42]
team2 is preferred  [0.58 0.58 0.58 ... 0.42 0.42 0.58]
</pre></div></div>
</div>
<div class="section" id="Fitting-a-Bradley-Terry-model">
<h2>Fitting a Bradley Terry model<a class="headerlink" href="#Fitting-a-Bradley-Terry-model" title="Permalink to this headline">¶</a></h2>
<p>As we can see in the example above the logistic regression approach does not learn different probabilities for a team winning or losing based on which other team they are playing. The Dallas Mavericks could be playing against the strongest or weakest team in the league and their estimated probability of winning would be the same. The difference between the Bradley-Terry model and logistic regression is that Bradley-Terry learns a function that can estimate whether each team will win or lose
given the other team they are playing.</p>
<p>The task we will use for Bradley-Terry will be defined in a slightly different way, because in the first demo we won’t use any covariates, therefore we define <code class="docutils literal notranslate"><span class="pre">features_to_use=None</span></code></p>
<p>In the Bradley-Terry model each team gets a latent strength parameter <span class="math notranslate nohighlight">\(\lambda_{\text{team}}\)</span>, for example <span class="math notranslate nohighlight">\(\lambda_{\text{Atlanta Hawks}}\)</span>.</p>
<p>The Bradley-Terry model learns these strength parameters to maximise the likelihood according to the following formulation for observation <span class="math notranslate nohighlight">\(i\)</span>:</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[P(\texttt{team1}\_\texttt{wins}=1)_i= \frac{e^{\lambda_{\texttt{team1}_i}}}{e^{\lambda_{\texttt{team1}_i}} + e^{\lambda_{\texttt{team2}_i}}}\]</div></div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NBA_results_task_train_BT</span> <span class="o">=</span> <span class="n">PairwiseComparisonTask</span><span class="p">(</span>
    <span class="n">primary_table</span><span class="o">=</span><span class="n">train_data</span><span class="p">,</span>
    <span class="n">primary_table_alternatives_names</span><span class="o">=</span><span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">],</span>
    <span class="n">primary_table_target_name</span> <span class="o">=</span><span class="s1">'team1_wins'</span><span class="p">,</span>
    <span class="n">target_column_correspondence</span><span class="o">=</span><span class="s1">'team1'</span><span class="p">,</span>
    <span class="n">features_to_use</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="n">NBA_results_task_predict_BT</span> <span class="o">=</span> <span class="n">PairwiseComparisonTask</span><span class="p">(</span>
    <span class="n">primary_table</span><span class="o">=</span><span class="n">test_data</span><span class="p">,</span>
    <span class="n">primary_table_alternatives_names</span><span class="o">=</span><span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">],</span>
    <span class="n">primary_table_target_name</span> <span class="o">=</span><span class="s1">'team1_wins'</span><span class="p">,</span>
    <span class="n">target_column_correspondence</span><span class="o">=</span><span class="s1">'team1'</span><span class="p">,</span>
    <span class="n">features_to_use</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitting Bradley Terry model</span>
<span class="n">mybt</span> <span class="o">=</span> <span class="n">BradleyTerry</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'BFGS'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">mybt</span><span class="o">.</span><span class="n">fit_task</span><span class="p">(</span><span class="n">NBA_results_task_train_BT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mybt</span><span class="o">.</span><span class="n">params_</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-wrapper"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>entity</th>
<th>learned_strength</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Atlanta Hawks</td>
<td>0.047522</td>
</tr>
<tr>
<th>1</th>
<td>Boston Celtics</td>
<td>0.580896</td>
</tr>
<tr>
<th>2</th>
<td>Brooklyn Nets</td>
<td>-1.178393</td>
</tr>
<tr>
<th>3</th>
<td>Charlotte Hornets</td>
<td>-0.278154</td>
</tr>
<tr>
<th>4</th>
<td>Chicago Bulls</td>
<td>-0.037967</td>
</tr>
<tr>
<th>5</th>
<td>Cleveland Cavaliers</td>
<td>0.489737</td>
</tr>
<tr>
<th>6</th>
<td>Dallas Mavericks</td>
<td>-0.386261</td>
</tr>
<tr>
<th>7</th>
<td>Denver Nuggets</td>
<td>-0.040408</td>
</tr>
<tr>
<th>8</th>
<td>Detroit Pistons</td>
<td>-0.225709</td>
</tr>
<tr>
<th>9</th>
<td>Golden State Warriors</td>
<td>1.538386</td>
</tr>
<tr>
<th>10</th>
<td>Houston Rockets</td>
<td>0.765613</td>
</tr>
<tr>
<th>11</th>
<td>Indiana Pacers</td>
<td>-0.005751</td>
</tr>
<tr>
<th>12</th>
<td>Los Angeles Clippers</td>
<td>0.550265</td>
</tr>
<tr>
<th>13</th>
<td>Los Angeles Lakers</td>
<td>-0.773690</td>
</tr>
<tr>
<th>14</th>
<td>Memphis Grizzlies</td>
<td>0.153646</td>
</tr>
<tr>
<th>15</th>
<td>Miami Heat</td>
<td>-0.022175</td>
</tr>
<tr>
<th>16</th>
<td>Milwaukee Bucks</td>
<td>0.018291</td>
</tr>
<tr>
<th>17</th>
<td>Minnesota Timberwolves</td>
<td>-0.470415</td>
</tr>
<tr>
<th>18</th>
<td>New Orleans Pelicans</td>
<td>-0.328205</td>
</tr>
<tr>
<th>19</th>
<td>New York Knicks</td>
<td>-0.548175</td>
</tr>
<tr>
<th>20</th>
<td>Oklahoma City Thunder</td>
<td>0.344454</td>
</tr>
<tr>
<th>21</th>
<td>Orlando Magic</td>
<td>-0.655354</td>
</tr>
<tr>
<th>22</th>
<td>Philadelphia 76ers</td>
<td>-0.716305</td>
</tr>
<tr>
<th>23</th>
<td>Phoenix Suns</td>
<td>-0.888314</td>
</tr>
<tr>
<th>24</th>
<td>Portland Trail Blazers</td>
<td>0.019229</td>
</tr>
<tr>
<th>25</th>
<td>Sacramento Kings</td>
<td>-0.426973</td>
</tr>
<tr>
<th>26</th>
<td>San Antonio Spurs</td>
<td>1.115135</td>
</tr>
<tr>
<th>27</th>
<td>Toronto Raptors</td>
<td>0.462682</td>
</tr>
<tr>
<th>28</th>
<td>Utah Jazz</td>
<td>0.535025</td>
</tr>
<tr>
<th>29</th>
<td>Washington Wizards</td>
<td>0.361368</td>
</tr>
</tbody>
</table></div>
</div></div>
</div>
<p>We can use the latent alternative strength parameters that Bradley-Terry models learn to rank the teams, either by sorting the <code class="docutils literal notranslate"><span class="pre">mybt.params_</span> <span class="pre">DataFrame</span></code> by the <code class="docutils literal notranslate"><span class="pre">learned_strength</span></code> parameter, or by running the <code class="docutils literal notranslate"><span class="pre">rank_entities</span></code> function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mybt</span><span class="o">.</span><span class="n">rank_entities</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
['Golden State Warriors',
 'San Antonio Spurs',
 'Houston Rockets',
 'Boston Celtics',
 'Los Angeles Clippers',
 'Utah Jazz',
 'Cleveland Cavaliers',
 'Toronto Raptors',
 'Washington Wizards',
 'Oklahoma City Thunder',
 'Memphis Grizzlies',
 'Atlanta Hawks',
 'Portland Trail Blazers',
 'Milwaukee Bucks',
 'Indiana Pacers',
 'Miami Heat',
 'Chicago Bulls',
 'Denver Nuggets',
 'Detroit Pistons',
 'Charlotte Hornets',
 'New Orleans Pelicans',
 'Dallas Mavericks',
 'Sacramento Kings',
 'Minnesota Timberwolves',
 'New York Knicks',
 'Orlando Magic',
 'Philadelphia 76ers',
 'Los Angeles Lakers',
 'Phoenix Suns',
 'Brooklyn Nets']
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we can create the probability for each team winning in a specific observaion,</span>
<span class="n">nice_print_results</span><span class="p">(</span>
    <span class="n">mybt</span><span class="o">.</span><span class="n">predict_proba_task</span><span class="p">(</span><span class="n">NBA_results_task_predict_BT</span><span class="p">,</span>
                            <span class="n">outcome</span><span class="o">=</span><span class="p">[</span><span class="s1">'Atlanta Hawks'</span><span class="p">,</span> <span class="s1">'Washington Wizards'</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Atlanta Hawks       [0.61 0.58 0.77 ... 0.42 0.   0.  ]
Washington Wizards  [0.   0.   0.   ... 0.58 0.45 0.73]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nice_print_results</span><span class="p">(</span>
    <span class="n">mybt</span><span class="o">.</span><span class="n">predict_proba_task</span><span class="p">(</span><span class="n">NBA_results_task_predict_BT</span><span class="p">,</span>
                            <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
team1 is preferred  [0.61 0.58 0.77 ... 0.58 0.45 0.73]
team2 is preferred  [0.39 0.42 0.23 ... 0.42 0.55 0.27]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mybt</span><span class="o">.</span><span class="n">predict_choice_task</span><span class="p">(</span><span class="n">NBA_results_task_predict_BT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array(['Atlanta Hawks', 'Atlanta Hawks', 'Atlanta Hawks', ...,
       'Washington Wizards', 'Boston Celtics', 'Washington Wizards'],
      dtype=object)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds</span> <span class="o">=</span> <span class="n">mybt</span><span class="o">.</span><span class="n">predict_task</span><span class="p">(</span><span class="n">NBA_results_task_predict_BT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds</span><span class="o">.</span><span class="n">top_input_data</span><span class="p">,</span> <span class="n">preds</span><span class="o">.</span><span class="n">boot_input_data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array(['Atlanta Hawks', 'Atlanta Hawks', 'Atlanta Hawks', ...,
        'Washington Wizards', 'Boston Celtics', 'Washington Wizards'],
       dtype=object),
 array(['Dallas Mavericks', 'Charlotte Hornets', 'Brooklyn Nets', ...,
        'Atlanta Hawks', 'Washington Wizards', 'Orlando Magic'],
       dtype=object))
</pre></div></div>
</div>
</div>
<div class="section" id="Augmenting-the-models-with-covariates">
<h2>Augmenting the models with covariates<a class="headerlink" href="#Augmenting-the-models-with-covariates" title="Permalink to this headline">¶</a></h2>
<p>In this section we will start introducing more covariates in the models above, we will introduce one additional covariate which is the team salary budget. We can also see how we can define a single task which we can use to run different models in skpref.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NBA_results_task_train</span> <span class="o">=</span> <span class="n">PairwiseComparisonTask</span><span class="p">(</span>
    <span class="n">primary_table</span><span class="o">=</span><span class="n">train_data</span><span class="p">,</span>
    <span class="n">primary_table_alternatives_names</span><span class="o">=</span><span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">],</span>
    <span class="n">primary_table_target_name</span> <span class="o">=</span><span class="s1">'team1_wins'</span><span class="p">,</span>
    <span class="n">target_column_correspondence</span><span class="o">=</span><span class="s1">'team1'</span><span class="p">,</span>
    <span class="n">features_to_use</span><span class="o">=</span><span class="p">[</span><span class="s1">'salary'</span><span class="p">,</span> <span class="s1">'team1_home'</span><span class="p">],</span>
    <span class="n">secondary_table</span><span class="o">=</span><span class="n">NBA_team_salary_budget</span><span class="p">,</span>
    <span class="n">secondary_to_primary_link</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">'team'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">],</span>
        <span class="s1">'season_start'</span><span class="p">:</span> <span class="s1">'season_start'</span>
    <span class="p">})</span>

<span class="n">NBA_results_task_predict</span> <span class="o">=</span> <span class="n">PairwiseComparisonTask</span><span class="p">(</span>
    <span class="n">primary_table</span><span class="o">=</span><span class="n">test_data</span><span class="p">,</span>
    <span class="n">primary_table_alternatives_names</span><span class="o">=</span><span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">],</span>
    <span class="n">primary_table_target_name</span> <span class="o">=</span><span class="s1">'team1_wins'</span><span class="p">,</span>
    <span class="n">target_column_correspondence</span><span class="o">=</span><span class="s1">'team1'</span><span class="p">,</span>
    <span class="n">features_to_use</span><span class="o">=</span><span class="p">[</span><span class="s1">'salary'</span><span class="p">,</span> <span class="s1">'team1_home'</span><span class="p">],</span>
    <span class="n">secondary_table</span><span class="o">=</span><span class="n">NBA_team_salary_budget</span><span class="p">,</span>
    <span class="n">secondary_to_primary_link</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">'team'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">],</span>
        <span class="s1">'season_start'</span><span class="p">:</span> <span class="s1">'season_start'</span>
    <span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Reduction-to-logistic-regression-with-covariates">
<h1>Reduction to logistic regression with covariates<a class="headerlink" href="#Reduction-to-logistic-regression-with-covariates" title="Permalink to this headline">¶</a></h1>
<p>Here we fit a logistic regression on three covariates, whether <code class="docutils literal notranslate"><span class="pre">team1</span></code> is playing home or not, <code class="docutils literal notranslate"><span class="pre">team1</span></code>’s salary budget and <code class="docutils literal notranslate"><span class="pre">team2</span></code>’s salary budget. <span class="math notranslate nohighlight">\(P(\texttt{team1}\_\texttt{wins}=1) = logit(\alpha + \beta_1 \texttt{team}\_\texttt{1}\_\texttt{home} + \beta_2 \texttt{team1}\_\texttt{salary} + \beta_3 \texttt{team2}\_\texttt{salary})\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_log_red</span> <span class="o">=</span> <span class="n">ClassificationReducer</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">'lbfgs'</span><span class="p">))</span>
<span class="n">my_log_red</span><span class="o">.</span><span class="n">fit_task</span><span class="p">(</span><span class="n">NBA_results_task_train</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">my_log_red</span><span class="o">.</span><span class="n">predict_task</span><span class="p">(</span><span class="n">NBA_results_task_predict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can investigate the internal table that was fed into LogisticRegression.fit()</span>
<span class="n">my_log_red</span><span class="o">.</span><span class="n">model_input</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-wrapper"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>team1_wins</th>
<th>team_1_home</th>
<th>salary_team1</th>
<th>salary_team2</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>1</td>
<td>0</td>
<td>99375302</td>
<td>85753772</td>
</tr>
<tr>
<th>1</th>
<td>0</td>
<td>0</td>
<td>99375302</td>
<td>117228164</td>
</tr>
<tr>
<th>2</th>
<td>0</td>
<td>0</td>
<td>99375302</td>
<td>95964560</td>
</tr>
<tr>
<th>3</th>
<td>0</td>
<td>0</td>
<td>99375302</td>
<td>129458084</td>
</tr>
<tr>
<th>4</th>
<td>0</td>
<td>0</td>
<td>99375302</td>
<td>89524016</td>
</tr>
<tr>
<th>5</th>
<td>0</td>
<td>1</td>
<td>99375302</td>
<td>107015203</td>
</tr>
<tr>
<th>6</th>
<td>0</td>
<td>1</td>
<td>99375302</td>
<td>115375243</td>
</tr>
</tbody>
</table></div>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can also investigate the coefficients which were learned</span>
<span class="n">my_log_red</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 5.35210228e-15,  1.54775613e-08, -1.54775613e-08]])
</pre></div></div>
</div>
<p>We can see that the coefficients learned for <span class="math notranslate nohighlight">\(\beta_2\)</span> and <span class="math notranslate nohighlight">\(\beta_3\)</span> are very similar to each other, just opposite signs. ClassificationReducer allows users the option to take the difference in features directly rather than split them out, effectively learning the following model: <span class="math notranslate nohighlight">\(P(\texttt{team1}\_\texttt{wins}=1) = logit(\alpha + \beta_1 \texttt{team}\_\texttt{1}\_\texttt{home} + \beta_2 (\texttt{team1}\_\texttt{salary} - \texttt{team2}\_\texttt{salary}))\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_log_red</span> <span class="o">=</span> <span class="n">ClassificationReducer</span><span class="p">(</span>
    <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">'lbfgs'</span><span class="p">),</span>
    <span class="n">take_feature_diff_for_pairwise_comparison</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">my_log_red</span><span class="o">.</span><span class="n">fit_task</span><span class="p">(</span><span class="n">NBA_results_task_train</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">my_log_red</span><span class="o">.</span><span class="n">predict_task</span><span class="p">(</span><span class="n">NBA_results_task_predict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_log_red</span><span class="o">.</span><span class="n">model_input</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-wrapper"><table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>team1_wins</th>
<th>team_1_home</th>
<th>salary_diff</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>1</td>
<td>0</td>
<td>13621530</td>
</tr>
<tr>
<th>1</th>
<td>0</td>
<td>0</td>
<td>-17852862</td>
</tr>
<tr>
<th>2</th>
<td>0</td>
<td>0</td>
<td>3410742</td>
</tr>
<tr>
<th>3</th>
<td>0</td>
<td>0</td>
<td>-30082782</td>
</tr>
<tr>
<th>4</th>
<td>0</td>
<td>0</td>
<td>9851286</td>
</tr>
<tr>
<th>5</th>
<td>0</td>
<td>1</td>
<td>-7639901</td>
</tr>
<tr>
<th>6</th>
<td>0</td>
<td>1</td>
<td>-15999941</td>
</tr>
</tbody>
</table></div>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_log_red</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[2.67602286e-15, 1.54775613e-08]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds</span><span class="o">.</span><span class="n">top_input_data</span><span class="p">,</span> <span class="n">preds</span><span class="o">.</span><span class="n">boot_input_data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array(['Atlanta Hawks', 'Charlotte Hornets', 'Atlanta Hawks', ...,
        'Washington Wizards', 'Washington Wizards', 'Washington Wizards'],
       dtype=object),
 array(['Dallas Mavericks', 'Atlanta Hawks', 'Brooklyn Nets', ...,
        'Atlanta Hawks', 'Boston Celtics', 'Orlando Magic'], dtype=object))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># All this learns so far is the home team advantage, since its the only</span>
<span class="c1"># covariate in the test_data table</span>
<span class="n">nice_print_results</span><span class="p">(</span>
    <span class="n">my_log_red</span><span class="o">.</span><span class="n">predict_proba_task</span><span class="p">(</span><span class="n">NBA_results_task_predict</span><span class="p">,</span>
                                  <span class="n">column</span><span class="o">=</span><span class="s1">'team1'</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
team1 is preferred  [0.55 0.43 0.51 ... 0.59 0.53 0.61]
</pre></div></div>
</div>
</div>
<div class="section" id="Bradley-Terry-model-with-salary-covariate">
<h1>Bradley Terry model with salary covariate<a class="headerlink" href="#Bradley-Terry-model-with-salary-covariate" title="Permalink to this headline">¶</a></h1>
<p>Here we augment the initial Bradley-Terry model to learn the following relationship:</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[P(\texttt{team1}\_\texttt{wins}=1)_i= \frac{e^{(\lambda_{\texttt{team1}_i} + \beta_1 \texttt{team1}\_\texttt{salary}_i)}}{e^{(\lambda_{\texttt{team1}_i} + \beta_1 \texttt{team1}\_\texttt{salary}_i)} + e^{(\lambda_{\texttt{team2}_i}+ \beta_1 \texttt{team2}\_\texttt{salary}_i)}}\]</div></div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mybt</span> <span class="o">=</span> <span class="n">BradleyTerry</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'BFGS'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">mybt</span><span class="o">.</span><span class="n">fit_task</span><span class="p">(</span><span class="n">NBA_results_task_train</span><span class="p">)</span>
<span class="n">mybt</span><span class="o">.</span><span class="n">rank_entities</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array(['Golden State Warriors', 'San Antonio Spurs', 'Houston Rockets',
       'Utah Jazz', 'Boston Celtics', 'Oklahoma City Thunder',
       'Washington Wizards', 'Toronto Raptors', 'Los Angeles Clippers',
       'Denver Nuggets', 'Atlanta Hawks', 'Indiana Pacers',
       'Chicago Bulls', 'Cleveland Cavaliers', 'Memphis Grizzlies',
       'Miami Heat', 'Milwaukee Bucks', 'Charlotte Hornets',
       'Minnesota Timberwolves', 'Portland Trail Blazers',
       'New Orleans Pelicans', 'Sacramento Kings', 'Detroit Pistons',
       'Dallas Mavericks', 'Philadelphia 76ers', 'New York Knicks',
       'Phoenix Suns', 'Los Angeles Lakers', 'Orlando Magic',
       'Brooklyn Nets'], dtype=object)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nice_print_results</span><span class="p">(</span><span class="n">mybt</span><span class="o">.</span><span class="n">predict_proba_task</span><span class="p">(</span><span class="n">NBA_results_task_predict</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s1">'team1'</span><span class="p">,</span> <span class="s1">'team2'</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
team1 is preferred  [0.69 0.48 0.75 ... 0.65 0.43 0.82]
team2 is preferred  [0.31 0.52 0.25 ... 0.35 0.57 0.18]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mybt</span><span class="o">.</span><span class="n">predict_choice_task</span><span class="p">(</span><span class="n">NBA_results_task_predict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array(['Atlanta Hawks', 'Charlotte Hornets', 'Atlanta Hawks', ...,
       'Washington Wizards', 'Boston Celtics', 'Washington Wizards'],
      dtype=object)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mybt</span><span class="o">.</span><span class="n">predict_task</span><span class="p">(</span><span class="n">NBA_results_task_predict</span><span class="p">)</span><span class="o">.</span><span class="n">top_input_data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array(['Atlanta Hawks', 'Charlotte Hornets', 'Atlanta Hawks', ...,
       'Washington Wizards', 'Boston Celtics', 'Washington Wizards'],
      dtype=object)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mybt</span><span class="o">.</span><span class="n">bt_with_feats</span><span class="o">.</span><span class="n">get_statsmodels_summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div class="table-wrapper"><table class="simpletable">
<caption>Multinomial Logit Model Regression Results</caption>
<tr>
<th>Dep. Variable:</th> <td>CHOICE</td> <th>  No. Observations:  </th> <td>2,460</td>
</tr>
<tr>
<th>Model:</th> <td>Multinomial Logit Model</td> <th>  Df Residuals:      </th> <td>2,429</td>
</tr>
<tr>
<th>Method:</th> <td>MLE</td> <th>  Df Model:          </th> <td>31</td>
</tr>
<tr>
<th>Date:</th> <td>Wed, 01 Mar 2023</td> <th>  Pseudo R-squ.:     </th> <td>0.107</td>
</tr>
<tr>
<th>Time:</th> <td>16:10:40</td> <th>  Pseudo R-bar-squ.: </th> <td>0.089</td>
</tr>
<tr>
<th>AIC:</th> <td>3,107.966</td> <th>  Log-Likelihood:    </th> <td>-1,522.983</td>
</tr>
<tr>
<th>BIC:</th> <td>3,288.012</td> <th>  LL-Null:           </th> <td>-1,705.142</td>
</tr>
</table></div>
<div class="table-wrapper"><table class="simpletable">
<tr>
<td></td> <th>coef</th> <th>std err</th> <th>z</th> <th>P&gt;|z|</th> <th>[0.025</th> <th>0.975]</th>
</tr>
<tr>
<th>salary</th> <td> 1.717e-08</td> <td> 3.65e-06</td> <td>    0.005</td> <td> 0.996</td> <td>-7.13e-06</td> <td> 7.17e-06</td>
</tr>
<tr>
<th>Atlanta Hawks</th> <td>    0.0810</td> <td>   41.439</td> <td>    0.002</td> <td> 0.998</td> <td>  -81.138</td> <td>   81.300</td>
</tr>
<tr>
<th>Boston Celtics</th> <td>    0.7344</td> <td>   52.254</td> <td>    0.014</td> <td> 0.989</td> <td> -101.682</td> <td>  103.151</td>
</tr>
<tr>
<th>Brooklyn Nets</th> <td>   -0.9380</td> <td>   65.383</td> <td>   -0.014</td> <td> 0.989</td> <td> -129.086</td> <td>  127.210</td>
</tr>
<tr>
<th>Charlotte Hornets</th> <td>   -0.1415</td> <td>   50.101</td> <td>   -0.003</td> <td> 0.998</td> <td>  -98.339</td> <td>   98.056</td>
</tr>
<tr>
<th>Chicago Bulls</th> <td>    0.0621</td> <td>   46.030</td> <td>    0.001</td> <td> 0.999</td> <td>  -90.156</td> <td>   90.280</td>
</tr>
<tr>
<th>Cleveland Cavaliers</th> <td>   -0.0049</td> <td>  112.740</td> <td>-4.33e-05</td> <td> 1.000</td> <td> -220.970</td> <td>  220.960</td>
</tr>
<tr>
<th>Dallas Mavericks</th> <td>   -0.4891</td> <td>   46.300</td> <td>   -0.011</td> <td> 0.992</td> <td>  -91.236</td> <td>   90.258</td>
</tr>
<tr>
<th>Denver Nuggets</th> <td>    0.2237</td> <td>   69.393</td> <td>    0.003</td> <td> 0.997</td> <td> -135.784</td> <td>  136.232</td>
</tr>
<tr>
<th>Detroit Pistons</th> <td>   -0.4001</td> <td>   55.137</td> <td>   -0.007</td> <td> 0.994</td> <td> -108.468</td> <td>  107.667</td>
</tr>
<tr>
<th>Golden State Warriors</th> <td>    1.4940</td> <td>   41.902</td> <td>    0.036</td> <td> 0.972</td> <td>  -80.632</td> <td>   83.620</td>
</tr>
<tr>
<th>Houston Rockets</th> <td>    0.9021</td> <td>   50.079</td> <td>    0.018</td> <td> 0.986</td> <td>  -97.252</td> <td>   99.056</td>
</tr>
<tr>
<th>Indiana Pacers</th> <td>    0.0727</td> <td>   44.101</td> <td>    0.002</td> <td> 0.999</td> <td>  -86.363</td> <td>   86.508</td>
</tr>
<tr>
<th>Los Angeles Clippers</th> <td>    0.2355</td> <td>   78.355</td> <td>    0.003</td> <td> 0.998</td> <td> -153.337</td> <td>  153.808</td>
</tr>
<tr>
<th>Los Angeles Lakers</th> <td>   -0.7116</td> <td>   42.901</td> <td>   -0.017</td> <td> 0.987</td> <td>  -84.796</td> <td>   83.373</td>
</tr>
<tr>
<th>Memphis Grizzlies</th> <td>   -0.0434</td> <td>   58.483</td> <td>   -0.001</td> <td> 0.999</td> <td> -114.668</td> <td>  114.581</td>
</tr>
<tr>
<th>Miami Heat</th> <td>   -0.0820</td> <td>   42.759</td> <td>   -0.002</td> <td> 0.998</td> <td>  -83.888</td> <td>   83.724</td>
</tr>
<tr>
<th>Milwaukee Bucks</th> <td>   -0.1289</td> <td>   51.425</td> <td>   -0.003</td> <td> 0.998</td> <td> -100.920</td> <td>  100.663</td>
</tr>
<tr>
<th>Minnesota Timberwolves</th> <td>   -0.1561</td> <td>   78.274</td> <td>   -0.002</td> <td> 0.998</td> <td> -153.569</td> <td>  153.257</td>
</tr>
<tr>
<th>New Orleans Pelicans</th> <td>   -0.3903</td> <td>   42.901</td> <td>   -0.009</td> <td> 0.993</td> <td>  -84.476</td> <td>   83.695</td>
</tr>
<tr>
<th>New York Knicks</th> <td>   -0.6348</td> <td>   44.785</td> <td>   -0.014</td> <td> 0.989</td> <td>  -88.412</td> <td>   87.143</td>
</tr>
<tr>
<th>Oklahoma City Thunder</th> <td>    0.4593</td> <td>   47.565</td> <td>    0.010</td> <td> 0.992</td> <td>  -92.766</td> <td>   93.685</td>
</tr>
<tr>
<th>Orlando Magic</th> <td>   -0.7402</td> <td>   44.632</td> <td>   -0.017</td> <td> 0.987</td> <td>  -88.217</td> <td>   86.736</td>
</tr>
<tr>
<th>Philadelphia 76ers</th> <td>   -0.5043</td> <td>   60.789</td> <td>   -0.008</td> <td> 0.993</td> <td> -119.649</td> <td>  118.640</td>
</tr>
<tr>
<th>Phoenix Suns</th> <td>   -0.6594</td> <td>   63.503</td> <td>   -0.010</td> <td> 0.992</td> <td> -125.123</td> <td>  123.804</td>
</tr>
<tr>
<th>Portland Trail Blazers</th> <td>   -0.2206</td> <td>   65.293</td> <td>   -0.003</td> <td> 0.997</td> <td> -128.192</td> <td>  127.751</td>
</tr>
<tr>
<th>Sacramento Kings</th> <td>   -0.3933</td> <td>   41.448</td> <td>   -0.009</td> <td> 0.992</td> <td>  -81.630</td> <td>   80.843</td>
</tr>
<tr>
<th>San Antonio Spurs</th> <td>    0.9525</td> <td>   53.485</td> <td>    0.018</td> <td> 0.986</td> <td> -103.876</td> <td>  105.781</td>
</tr>
<tr>
<th>Toronto Raptors</th> <td>    0.2806</td> <td>   56.240</td> <td>    0.005</td> <td> 0.996</td> <td> -109.949</td> <td>  110.510</td>
</tr>
<tr>
<th>Utah Jazz</th> <td>    0.8459</td> <td>   77.655</td> <td>    0.011</td> <td> 0.991</td> <td> -151.355</td> <td>  153.047</td>
</tr>
<tr>
<th>Washington Wizards</th> <td>    0.2946</td> <td>   43.216</td> <td>    0.007</td> <td> 0.995</td> <td>  -84.407</td> <td>   84.997</td>
</tr>
</table></div></div>
</div>
</div>
<div class="section" id="Example-using-GridSearchCV()">
<h1>Example using GridSearchCV()<a class="headerlink" href="#Example-using-GridSearchCV()" title="Permalink to this headline">¶</a></h1>
<p>The models we have fitted above also have hyperparameters, such as the method of gradient descent or regularisation. To optimise the hyperparameter selection, we can use <code class="docutils literal notranslate"><span class="pre">GridSearchCV()</span></code>. <code class="docutils literal notranslate"><span class="pre">GridSearchCV()</span></code> tries out a series of hyperparameter combinations and runs a k-fold cross-validation on an accuracy metric determined by the user to check which ones have performed best.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">to_tune</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'alpha'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">'method'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'BFGS'</span><span class="p">]}</span>
<span class="n">gs_bt</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">BradleyTerry</span><span class="p">(),</span> <span class="n">to_tune</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">'neg_log_loss'</span><span class="p">)</span>
<span class="n">gs_bt</span><span class="o">.</span><span class="n">fit_task</span><span class="p">(</span><span class="n">NBA_results_task_train</span><span class="p">)</span>
<span class="n">gs_bt</span><span class="o">.</span><span class="n">inspect_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The model with the best parameters was:
BradleyTerry(alpha=2, method='BFGS')
With a score of -0.6265008194657992
All the trials results summarised in descending score
   alpha method  mean_test_score
1      2   BFGS        -0.626501
0      1   BFGS        -0.626742
2      4   BFGS        -0.628853
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Showing that sklearn.metrics works also</span>
<span class="n">to_tune</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'alpha'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">'method'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'BFGS'</span><span class="p">]}</span>
<span class="n">gs_bt</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">BradleyTerry</span><span class="p">(),</span> <span class="n">to_tune</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">f1_score</span><span class="p">)</span>
<span class="n">gs_bt</span><span class="o">.</span><span class="n">fit_task</span><span class="p">(</span><span class="n">NBA_results_task_train</span><span class="p">)</span>
<span class="n">gs_bt</span><span class="o">.</span><span class="n">inspect_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The model with the best parameters was:
BradleyTerry(alpha=4, method='BFGS')
With a score of 0.6337744652191032
All the trials results summarised in descending score
   alpha method  mean_test_score
2      4   BFGS         0.633774
1      2   BFGS         0.631136
0      1   BFGS         0.630085
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">to_tune</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'C'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="s1">'solver'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'saga'</span><span class="p">],</span> <span class="s1">'penalty'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'l1'</span><span class="p">,</span><span class="s1">'l2'</span><span class="p">],</span>
           <span class="s1">'fit_intercept'</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}</span>
<span class="n">gs_lr</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">ClassificationReducer</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">()),</span> <span class="n">to_tune</span><span class="p">,</span>
                     <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">'neg_log_loss'</span><span class="p">)</span>
<span class="n">gs_lr</span><span class="o">.</span><span class="n">fit_task</span><span class="p">(</span><span class="n">NBA_results_task_train</span><span class="p">)</span>
<span class="n">gs_lr</span><span class="o">.</span><span class="n">inspect_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The model with the best parameters was:
ClassificationReducer(model=LogisticRegression(C=0.5, penalty='l1',
                                               solver='saga'))
With a score of -0.6865126660183437
All the trials results summarised in descending score
    model__C  model__fit_intercept model__penalty model__solver  \
0        0.5                  True             l1          saga
13       4.0                  True             l2          saga
6        1.0                 False             l1          saga
2        0.5                 False             l1          saga
5        1.0                  True             l2          saga
16       8.0                  True             l1          saga
10       2.0                 False             l1          saga
19       8.0                 False             l2          saga
9        2.0                  True             l2          saga
14       4.0                 False             l1          saga
18       8.0                 False             l1          saga
4        1.0                  True             l1          saga
11       2.0                 False             l2          saga
1        0.5                  True             l2          saga
17       8.0                  True             l2          saga
15       4.0                 False             l2          saga
7        1.0                 False             l2          saga
8        2.0                  True             l1          saga
3        0.5                 False             l2          saga
12       4.0                  True             l1          saga

    mean_test_score
0         -0.686513
13        -0.686516
6         -0.686516
2         -0.686517
5         -0.686517
16        -0.686517
10        -0.686518
19        -0.686518
9         -0.686518
14        -0.686518
18        -0.686518
4         -0.686518
11        -0.686519
1         -0.686519
17        -0.686519
15        -0.686520
7         -0.686520
8         -0.686520
3         -0.686521
12        -0.686522
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_lr</span><span class="o">.</span><span class="n">predict_task</span><span class="p">(</span><span class="n">NBA_results_task_predict</span><span class="p">)</span><span class="o">.</span><span class="n">top_input_data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array(['Atlanta Hawks', 'Charlotte Hornets', 'Atlanta Hawks', ...,
       'Washington Wizards', 'Washington Wizards', 'Washington Wizards'],
      dtype=object)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nice_print_results</span><span class="p">(</span><span class="n">gs_lr</span><span class="o">.</span><span class="n">predict_proba_task</span><span class="p">(</span><span class="n">NBA_results_task_predict</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">'team1'</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
team1 is preferred  [0.55 0.43 0.51 ... 0.59 0.53 0.61]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nice_print_results</span><span class="p">(</span><span class="n">gs_bt</span><span class="o">.</span><span class="n">predict_proba_task</span><span class="p">(</span><span class="n">NBA_results_task_predict</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">'team1'</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
team1 is preferred  [0.67 0.47 0.7  ... 0.64 0.45 0.79]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gs_bt</span><span class="o">.</span><span class="n">rank_entities</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array(['Golden State Warriors', 'San Antonio Spurs', 'Houston Rockets',
       'Utah Jazz', 'Boston Celtics', 'Oklahoma City Thunder',
       'Washington Wizards', 'Toronto Raptors', 'Los Angeles Clippers',
       'Denver Nuggets', 'Atlanta Hawks', 'Indiana Pacers',
       'Chicago Bulls', 'Cleveland Cavaliers', 'Memphis Grizzlies',
       'Miami Heat', 'Milwaukee Bucks', 'Charlotte Hornets',
       'Minnesota Timberwolves', 'Portland Trail Blazers',
       'Detroit Pistons', 'New Orleans Pelicans', 'Sacramento Kings',
       'Philadelphia 76ers', 'Dallas Mavericks', 'New York Knicks',
       'Phoenix Suns', 'Los Angeles Lakers', 'Orlando Magic',
       'Brooklyn Nets'], dtype=object)
</pre></div></div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="swissmetro_discrete_choice.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">We will demonstrate skpref on discrete choice data</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="jupyter_notebook_examples.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Jupyter Notebook Examples</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2022, István Papp, Franz Király, Ioanna Manolopoulou, Karlson Pfannschmidt, Pritha Gupta |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="_sources/example_using_sports_data.ipynb.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Bradley Terry example notebook</a></li>
<li><a class="reference internal" href="#Reading-in-the-data">Reading in the data</a></li>
<li><a class="reference internal" href="#Setting-up-the-tasks">Setting up the tasks</a></li>
<li><a class="reference internal" href="#Fitting-a-Logistic-Regression">Fitting a Logistic Regression</a><ul>
<li><a class="reference internal" href="#Fitting-a-Bradley-Terry-model">Fitting a Bradley Terry model</a></li>
<li><a class="reference internal" href="#Augmenting-the-models-with-covariates">Augmenting the models with covariates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Reduction-to-logistic-regression-with-covariates">Reduction to logistic regression with covariates</a></li>
<li><a class="reference internal" href="#Bradley-Terry-model-with-salary-covariate">Bradley Terry model with salary covariate</a></li>
<li><a class="reference internal" href="#Example-using-GridSearchCV()">Example using GridSearchCV()</a></li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    </body>
</html>